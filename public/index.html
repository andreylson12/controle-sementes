<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Sementes - Fazenda</title>
  <meta name="theme-color" content="#22d3ee" />
  <link rel="manifest" href="manifest.json?v=1.7.0" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css?v=1.7.0" />
  <style>
    /* toques visuais r√°pidos pro dashboard */
    .kpis {display:grid;grid-template-columns:repeat(5,minmax(180px,1fr));gap:.75rem;margin:.75rem 0}
    .kpi {background:#0f172a;border:1px solid #1f2937;border-radius:.75rem;padding:.9rem}
    .kpi h4{margin:0 0 .25rem;font-size:.9rem;color:#94a3b8;font-weight:600}
    .kpi .big{font-size:1.35rem;font-weight:700}
    .toolbar{display:flex;gap:.5rem;align-items:end;margin:.5rem 0 1rem}
    .toolbar label{font-size:.9rem}
    .toolbar input,.toolbar select,.toolbar button{padding:.45rem .6rem}
    table tfoot td{font-weight:600}
    .soft{opacity:.7}
  </style>
</head>
<body>
  <header>
    <h1>Controle de Sementes</h1>
    <nav>
      <button class="tab-btn" data-tab="dash">Resumo</button>
      <button class="tab-btn" data-tab="cadastro">Cadastro de Lotes</button>
      <button class="tab-btn" data-tab="tratamento">Tratamento</button>
      <button class="tab-btn" data-tab="saida">Sa√≠da / Envio</button>
      <button class="tab-btn" data-tab="estoque">Estoque</button>
      <button class="tab-btn" data-tab="config">Configura√ß√µes</button>
    </nav>
    <div style="margin-left:auto; display:flex; gap:.5rem; align-items:center">
      <label style="font-size:.9rem">T√©cnico:
        <input id="techName" placeholder="Seu nome" style="padding:.25rem .5rem" />
      </label>
      <button id="saveTech" type="button">Usar</button>
      <button id="enableAlerts" type="button" title="Ativar notifica√ß√µes e som">üîî Ativar alertas</button>
    </div>
  </header>

  <main>
    <!-- ================== DASHBOARD ================== -->
    <section id="dash" class="tab active">
      <h2>Resumo Executivo</h2>

      <div class="toolbar" id="dashToolbar">
        <label>Variedade<br><input id="fDashVar" placeholder="ex.: MURALHA" /></label>
        <label>Per√≠odo de<br><input id="fDashFrom" type="date" /></label>
        <label>at√©<br><input id="fDashTo" type="date" /></label>
        <button id="btnDashFiltrar" type="button">Filtrar</button>
        <button id="btnDashLimpar" type="button">Limpar</button>
        <span style="flex:1"></span>
        <button id="btnDashPDF" type="button">PDF do Resumo</button>
      </div>

      <div class="kpis">
        <div class="kpi"><h4>Entrou (per√≠odo)</h4><div class="big" id="kpiEntradasKg">0 kg</div><div class="soft" id="kpiEntradasBag">0 bag</div></div>
        <div class="kpi"><h4>Tratado (per√≠odo)</h4><div class="big" id="kpiTratKg">0 kg</div><div class="soft" id="kpiTratBag">0 bag</div></div>
        <div class="kpi"><h4>N√£o tratado (per√≠odo)</h4><div class="big" id="kpiNaoTratKg">0 kg</div><div class="soft" id="kpiNaoTratBag">0 bag</div></div>
        <div class="kpi"><h4>Sa√≠das (per√≠odo)</h4><div class="big" id="kpiSaidasKg">0 kg</div><div class="soft" id="kpiSaidasBag">0 bag</div></div>
        <div class="kpi"><h4>Estoque Atual</h4><div class="big" id="kpiEstoqueKg">0 kg</div><div class="soft" id="kpiEstoqueBag">0 bag</div></div>
      </div>

      <p class="soft" style="margin:.25rem 0 0">
        Observa√ß√£o: ‚ÄúN√£o tratado (per√≠odo)‚Äù = Entrou (kg) ‚àí Tratado (kg) no per√≠odo filtrado. O ‚ÄúEstoque Atual‚Äù ignora o filtro de per√≠odo e considera o saldo atual por lote.
      </p>
    </section>

    <!-- ================== CADASTRO ================== -->
    <section id="cadastro" class="tab">
      <h2>Novo Lote</h2>
      <form id="formLote">
        <div class="grid">
          <label>Variedade <input name="variety" required /></label>
          <label>Fornecedor <input name="supplier" required /></label>
          <label>C√≥digo do Lote <input name="lot_code" required /></label>
          <label>Data Recebimento <input type="date" name="received_at" required /></label>
          <label>Unidade
            <select name="unit">
              <option value="kg">kg</option>
              <option value="sc">sc</option>
              <option value="bag">bag</option>
            </select>
          </label>
          <label>Quantidade <input type="number" step="0.01" name="qty" required /></label>
        </div>
        <button>Salvar Lote</button>
      </form>

      <h3>Lotes cadastrados</h3>
      <table id="tblLotes">
        <thead>
          <tr>
            <th>Variedade</th>
            <th>Fornecedor</th>
            <th>Lote</th>
            <th>Recebido</th>
            <th>Qtd (unidade)</th>
            <th>Saldo (bag)</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ================== TRATAMENTO ================== -->
    <section id="tratamento" class="tab">
      <h2>Registrar Tratamento</h2>
      <form id="formTrat">
        <div class="grid">
          <label>Lote
            <select name="lot_id" id="selLotTrat"></select>
          </label>
          <label>Produto <input name="product" required /></label>
          <label>Dose por 100kg <input type="number" step="0.01" name="dose_per_100kg" value="0" /></label>
          <label>Operador <input name="operator" required /></label>
          <label>Data <input type="date" name="treated_at" required /></label>

          <label>Unidade tratada
            <select name="unit">
              <option value="kg">kg</option>
              <option value="sc">sc</option>
              <option value="bag">bag</option>
            </select>
          </label>
          <label>Quantidade tratada
            <input type="number" step="0.01" name="qty" required />
          </label>

          <label>Observa√ß√µes <input name="notes" /></label>
        </div>
        <button>Salvar Tratamento</button>
      </form>

      <h3>Tratamentos</h3>

      <div class="toolbar" id="tratToolbar">
        <label>Lote<br><input id="fTratLot" placeholder="ex.: MURALHA ou PS8085" /></label>
        <label>Produto<br><input id="fTratProd" placeholder="ex.: GRAFITE" /></label>
        <label>de<br><input id="fTratFrom" type="date" /></label>
        <label>at√©<br><input id="fTratTo" type="date" /></label>
        <button id="btnTratFiltrar" type="button">Filtrar</button>
        <button id="btnTratLimpar" type="button">Limpar</button>
        <span style="flex:1"></span>
        <div style="opacity:.8">Registros: <b id="tratCount">0</b></div>
      </div>

      <table id="tblTrat">
        <thead>
          <tr>
            <th>Lote</th>
            <th>Produto</th>
            <th>Qtd tratada (bag / kg)</th>
            <th>Dose/100kg</th>
            <th>Operador</th>
            <th>Data</th>
            <th>Obs</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="2"><strong>Totais (ap√≥s filtro)</strong></td>
            <td id="tratSum" colspan="6">0 bag (0 kg)</td>
          </tr>
        </tfoot>
      </table>
    </section>

    <!-- ================== SA√çDA ================== -->
    <section id="saida" class="tab">
      <h2>Sa√≠da / Envio</h2>
      <form id="formMov">
        <div class="grid">
          <label>Lote
            <select name="lot_id" id="selLotMov"></select>
          </label>
          <label>Destino (lavoura ou fazenda)
            <select name="destination_type">
              <option value="lavoura">lavoura</option>
              <option value="fazenda">fazenda</option>
            </select>
          </label>
          <label>Nome do Destino <input name="destination_name" required /></label>
          <label>Unidade
            <select name="unit">
              <option value="kg">kg</option>
              <option value="sc">sc</option>
              <option value="bag">bag</option>
            </select>
          </label>
          <label>Quantidade <input type="number" step="0.01" name="qty" required /></label>
          <label>Data <input type="date" name="moved_at" required /></label>
          <label>Observa√ß√µes <input name="notes" /></label>
        </div>
        <button>Registrar Sa√≠da</button>
      </form>

      <h3>Movimenta√ß√µes</h3>

      <div class="toolbar" id="movToolbar">
        <label>Lote<br><input id="fMovLot" placeholder="ex.: MURALHA ou PS8085" /></label>
        <label>Destino<br><input id="fMovDest" placeholder="ex.: FAZENDA B..." /></label>
        <label>de<br><input id="fMovFrom" type="date" /></label>
        <label>at√©<br><input id="fMovTo" type="date" /></label>
        <button id="btnMovFiltrar" type="button">Filtrar</button>
        <button id="btnMovLimpar" type="button">Limpar</button>
        <span style="flex:1"></span>
        <div style="opacity:.8">Registros: <b id="movCount">0</b></div>
      </div>

      <table id="tblMov">
        <thead>
          <tr>
            <th>Lote</th>
            <th>Destino</th>
            <th>Qtd (unid)</th>
            <th>Qtd (kg)</th>
            <th>Data</th>
            <th>Obs</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="2"><strong>Totais (ap√≥s filtro)</strong></td>
            <td id="movSumUnid">0</td>
            <td id="movSumKg">0</td>
            <td colspan="3"></td>
          </tr>
        </tfoot>
      </table>
    </section>

    <!-- ================== ESTOQUE ================== -->
    <section id="estoque" class="tab">
      <h2>Estoque por Lote</h2>

      <div class="toolbar" id="estoqueToolbar">
        <label>Variedade<br><input id="fVar" placeholder="ex.: MURALHA" /></label>
        <label>Lote<br><input id="fLote" placeholder="ex.: PS808512-7025" /></label>
        <label>Receb. de<br><input id="fFrom" type="date" /></label>
        <label>at√©<br><input id="fTo" type="date" /></label>
        <label style="display:flex;gap:.25rem;align-items:center"><input id="fSaldo" type="checkbox" checked/> S√≥ com saldo</label>
        <button id="btnFiltrar" type="button">Filtrar</button>
        <button id="btnLimpar" type="button">Limpar</button>
        <span style="flex:1"></span>
        <div class="print-group" style="display:flex; gap:.5rem">
          <button id="btnPDFEntradas" type="button">PDF Entradas</button>
          <button id="btnPDFSaidas" type="button">PDF Sa√≠das</button>
        </div>
      </div>

      <table id="tblEstoque">
        <thead>
          <tr>
            <th>Variedade</th>
            <th>Lote</th>
            <th>Recebido em</th>
            <th>Entradas (kg)</th>
            <th>Sa√≠das (kg)</th>
            <th>Saldo (kg)</th>
            <th>sc</th>
            <th>bag</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="3"><strong>Totais (ap√≥s filtro)</strong></td>
            <td id="sumIn">0</td>
            <td id="sumOut">0</td>
            <td id="sumKg">0</td>
            <td id="sumSc">0</td>
            <td id="sumBag">0</td>
          </tr>
        </tfoot>
      </table>

      <div id="estoqueResumo" style="display:flex;gap:1rem;justify-content:flex-end;margin:.5rem 0 0;color:#94a3b8">
        <span id="countLots">0 lotes</span><span>|</span>
        <span>kg: <b id="sumKg2">0</b></span>
        <span>sc: <b id="sumSc2">0</b></span>
        <span>bag: <b id="sumBag2">0</b></span>
      </div>
    </section>

    <!-- ================== CONFIG ================== -->
    <section id="config" class="tab">
      <h2>Configura√ß√µes de Unidade</h2>
      <form id="formCfg">
        <div class="grid">
          <label>kg por saca (sc) <input type="number" step="0.01" name="kg_per_sc" required /></label>
          <label>kg por big bag <input type="number" step="0.01" name="kg_per_bag" required /></label>
        </div>
        <button>Salvar Configura√ß√µes</button>
      </form>
    </section>
  </main>

  <footer><small>Sistema simples para Railway/GitHub ‚Ä¢ v1.7.0 (PWA + Realtime)</small></footer>

  <script src="/socket.io/socket.io.js"></script>
  <script src="script.js?v=1.7.0"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("serviceWorker.js?v=1.7.0").catch(console.error);
    }
  </script>

  <div id="toasts" style="position:fixed; right:1rem; bottom:1rem; z-index:9999"></div>
</body>
</html>
